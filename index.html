<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Al-Qur'an Digital - Sahal Arbani</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Amiri:wght@400;700&display=swap" rel="stylesheet">
  <style>
:root {
  /* Color System */
  --primary-50: #f0f9ff;
  --primary-100: #e0f2fe;
  --primary-200: #bae6fd;
  --primary-300: #7dd3fc;
  --primary-400: #38bdf8;
  --primary-500: #0ea5e9;
  --primary-600: #0284c7;
  --primary-700: #0369a1;
  --primary-800: #075985;
  --primary-900: #0c4a6e;
  
  --neutral-50: #fafafa;
  --neutral-100: #f5f5f5;
  --neutral-200: #e5e5e5;
  --neutral-300: #d4d4d4;
  --neutral-400: #a3a3a3;
  --neutral-500: #737373;
  --neutral-600: #525252;
  --neutral-700: #404040;
  --neutral-800: #262626;
  --neutral-900: #171717;
  
  --success-500: #10b981;
  --warning-500: #f59e0b;
  --error-500: #ef4444;
  
  /* Spacing System */
  --space-1: 0.25rem;
  --space-2: 0.5rem;
  --space-3: 0.75rem;
  --space-4: 1rem;
  --space-5: 1.25rem;
  --space-6: 1.5rem;
  --space-8: 2rem;
  --space-10: 2.5rem;
  --space-12: 3rem;
  --space-16: 4rem;
  --space-20: 5rem;
  
  /* Typography */
  --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  --font-arabic: 'Amiri', serif;
  
  /* Shadows */
  --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
  --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
  --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
  --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
  
  /* Border Radius */
  --radius-sm: 0.375rem;
  --radius-md: 0.5rem;
  --radius-lg: 0.75rem;
  --radius-xl: 1rem;
  --radius-2xl: 1.5rem;
}

body.light-mode {
  background: var(--neutral-50);
  color: var(--neutral-900);
}

body.light-mode .glass {
  background: rgba(255, 255, 255, 0.8);
  backdrop-filter: blur(12px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  box-shadow: var(--shadow-lg);
}

body.light-mode .verse-container {
  background: rgba(255, 255, 255, 0.9);
  border-left-color: var(--primary-500);
  border: 1px solid var(--neutral-200);
}

body.light-mode .verse-container.active {
  background-color: var(--primary-50);
  border-color: var(--primary-300);
}

body.light-mode .verse-text-latin {
  color: var(--success-500);
}

body.light-mode .verse-number-arabic {
  color: var(--warning-500);
}

body.light-mode .btn-pill {
  color: white;
}

body.light-mode .navbar-brand{
  color: var(--neutral-900);
  font-weight: 600;
}

body.light-mode .form-dark{
  border: 1px solid var(--neutral-300);
  color: var(--neutral-900);
  background: white;
}

body.light-mode .form-dark::-webkit-input-placeholder {
  color: var(--neutral-500);
}

body.light-mode .form-dark:-ms-input-placeholder {
  color: var(--neutral-500);
}

body.light-mode .form-dark::placeholder {
  color: var(--neutral-500);
}

body {
  font-family: var(--font-sans);
  background: linear-gradient(135deg, var(--neutral-900) 0%, #0f172a 100%);
  color: white;
  margin-top: 80px;
  overflow-x: hidden;
  line-height: 1.6;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

.glass {
  margin-bottom: var(--space-6);
  padding: var(--space-6);
  border-left: 4px solid var(--primary-400);
  background: rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(16px);
  border-radius: var(--radius-xl);
  border: 1px solid rgba(255, 255, 255, 0.1);
  box-shadow: var(--shadow-xl);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.glass:hover {
  transform: translateY(-2px);
  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
  background: rgba(255, 255, 255, 0.08);
}

.mt-6 { margin-top: 80px; }
.mt-7 { margin-top: 140px; }
.mt-8 { margin-top: 60px; }
.mt-9 { margin-top: 210px; }
.my-31 { margin-top: var(--space-4); }

.bg-blur {
  backdrop-filter: blur(20px);
  background: rgba(0, 0, 0, 0.4);
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.bg-f {
  margin-bottom: var(--space-6);
  backdrop-filter: blur(16px);
  color: white;
  padding: var(--space-6);
  border-left: 4px solid var(--primary-400);
  background: rgba(0, 0, 0, 0.6);
  border-radius: var(--radius-xl);
  border: 1px solid rgba(255, 255, 255, 0.1);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.btn-pill {
  border-radius: 50px;
  background: linear-gradient(135deg, var(--primary-500), var(--primary-600));
  color: white;
  border: none;
  padding: var(--space-3) var(--space-5);
  font-weight: 500;
  font-size: 0.875rem;
  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: var(--shadow-md);
  position: relative;
  overflow: hidden;
}

.btn-pill::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
  transition: left 0.5s;
}

.btn-pill:hover {
  background: linear-gradient(135deg, var(--primary-600), var(--primary-700));
  transform: translateY(-1px);
  box-shadow: var(--shadow-lg);
}

.btn-pill:hover::before {
  left: 100%;
}

.btn-pill:active {
  transform: translateY(0);
}

.verse-container {
  margin-bottom: var(--space-6);
  padding: var(--space-6);
  border-left: 4px solid var(--primary-400);
  background: rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(12px);
  border-radius: var(--radius-xl);
  border: 1px solid rgba(255, 255, 255, 0.1);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.verse-container:hover {
  background: rgba(255, 255, 255, 0.08);
  transform: translateY(-1px);
}

.verse-container.active {
  background-color: rgba(14, 165, 233, 0.15);
  border-color: var(--primary-400);
  box-shadow: 0 0 0 1px var(--primary-400);
}

.verse-text-arab {
  font-family: var(--font-arabic);
  font-size: 1.875rem; /* Ukuran default */
  text-align: right;
  line-height: 2.2;
  font-weight: 400;
  margin-bottom: var(--space-4);
  transition: font-size 0.3s ease; /* BARU: transisi halus saat ganti ukuran */
}

.verse-text-latin {
  color: var(--success-500);
  font-style: italic;
  margin-bottom: var(--space-3);
  font-size: 0.95rem;
}

.verse-number-arabic {
  font-size: 1.25rem;
  color: var(--warning-500);
  margin-bottom: var(--space-3);
  font-weight: 600;
}

.navbar-brand {
  font-weight: 700;
  font-size: 1.5rem;
  background: linear-gradient(135deg, var(--primary-400), var(--primary-600));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.form-dark {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: var(--radius-lg);
  color: white;
  padding: var(--space-3) var(--space-4);
  transition: all 0.2s ease;
}

.form-dark:focus {
  outline: none;
  border-color: var(--primary-400);
  box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.1);
  background: rgba(255, 255, 255, 0.08);
}

.form-dark::placeholder {
  color: rgba(255, 255, 255, 0.6);
}

.nav-link {
  cursor: pointer;
}

.loading {
  display: none;
  text-align: center;
  padding: var(--space-8);
}

.active-page {
  display: block !important;
}

.page {
  display: none;
}

/* Enhanced Card Design */
.surah-card {
  background: rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(12px);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: var(--radius-xl);
  padding: var(--space-6);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
}

.surah-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 2px;
  background: linear-gradient(90deg, var(--primary-400), var(--primary-600));
  transform: scaleX(0);
  transition: transform 0.3s ease;
}

.surah-card:hover::before {
  transform: scaleX(1);
}

.surah-card:hover {
  transform: translateY(-4px);
  box-shadow: var(--shadow-xl);
  background: rgba(255, 255, 255, 0.08);
}

.surah-title {
  font-size: 1.25rem;
  font-weight: 600;
  margin-bottom: var(--space-2);
  color: white;
}

.surah-meta {
  color: rgba(255, 255, 255, 0.7);
  font-size: 0.875rem;
  margin-bottom: var(--space-4);
}

/* Loading Animation */
.loading-spinner {
  display: inline-block;
  width: 40px;
  height: 40px;
  border: 3px solid rgba(255, 255, 255, 0.3);
  border-radius: 50%;
  border-top-color: var(--primary-400);
  animation: spin 1s ease-in-out infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* Responsive Design */
@media (max-width: 768px) {
  .verse-text-arab {
    font-size: 1.5rem;
    line-height: 2;
  }
  
  .glass, .verse-container, .bg-f {
    padding: var(--space-4);
    margin-bottom: var(--space-4);
  }
  
  .btn-pill {
    padding: var(--space-2) var(--space-4);
    font-size: 0.8rem;
  }
  
  .mt-7 { margin-top: 120px; }
}

@media (max-width: 576px) {
  .verse-text-arab {
    font-size: 1.375rem;
  }
  
  .surah-title {
    font-size: 1.125rem;
  }
}

/* Smooth Scrolling */
html {
  scroll-behavior: smooth;
}

/* Focus States */
*:focus {
  outline: 2px solid var(--primary-400);
  outline-offset: 2px;
}

/* Selection */
::selection {
  background-color: var(--primary-400);
  color: white;
}
  
/* CSS untuk Floating Action Button (FAB) */
.fab-container {
  position: fixed;
  bottom: 2rem;
  right: 2rem;
  z-index: 1050;
  display: flex;
  flex-direction: column-reverse;
  align-items: center;
}

.fab-main {
  width: 56px;
  height: 56px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5rem;
  box-shadow: var(--shadow-lg);
  cursor: pointer;
  z-index: 2;
}

.fab-options {
  display: flex;
  flex-direction: column-reverse;
  align-items: center;
  list-style: none;
  padding: 0;
  margin: 0;
  margin-bottom: 1rem;
  transform: scale(0);
  transform-origin: bottom center;
  transition: transform 0.2s cubic-bezier(0.4, 0, 0.2, 1);
}

.fab-container.open .fab-options {
  transform: scale(1);
}

.fab-option {
  width: 48px;
  height: 48px;
  margin-top: 0.75rem;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.25rem;
  opacity: 0;
  transition: opacity 0.2s ease-in-out;
}

.fab-container.open .fab-option {
  opacity: 1;
}

/* Penyesuaian untuk Halaman dengan FAB */
#detailPage, #tahlilPage, #hadrohPage {
  /* Memberi ruang di bagian bawah agar konten tidak tertutup FAB */
  padding-bottom: 80px; 
}
</style>
</head>
<body>

<nav class="navbar navbar-dark bg-blur fixed-top">
  <div class="container-fluid">
    <span class="navbar-brand mb-0 h1">
      <i class="bi bi-book me-2"></i>Al-Qur'an Digital
    </span>
    <div class="d-none d-lg-flex align-items-center gap-3">
      <select id="qoriSelect" class="form-dark form-select border-0" style="min-width: 180px;">
        <option selected>Pilih Qori</option>
        <option value="01">Abdullah Al-Juhany</option>
        <option value="02">Abdul Muhsin Al-Qasim</option>
        <option value="03">Abdurrahman As-Sudais</option>
        <option value="04">Ibrahim Al-Dossari</option>
        <option value="05">Misyari Rasyid Al-Afasi</option>
      </select>
      <button class="btn btn-pill" id="darkModeToggle">
        <i class="bi bi-moon-fill" id="darkModeIcon"></i>
      </button>
    </div>
    <button class="navbar-toggler d-lg-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#sidebarMenu" aria-controls="sidebarMenu">
      <span class="navbar-toggler-icon"></span>
    </button>
  </div>
</nav>

<div class="offcanvas offcanvas-end bg-blur" tabindex="-1" id="sidebarMenu" aria-labelledby="sidebarMenuLabel" data-bs-theme="dark">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title" id="sidebarMenuLabel">Menu & Pengaturan</h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body">
    <div class="d-grid gap-3" id="sidebarControlsContainer">
      <div>
        <label for="searchInput" class="form-label">Cari Surah</label>
        <input type="text" id="searchInput" class="form-dark form-control" placeholder="Contoh: Al-Fatihah">
      </div>
      <hr class="my-2">
      <div>
        <label for="qoriSelectMobile" class="form-label">Pilih Qori</label>
        <select id="qoriSelectMobile" class="form-dark form-select border-0">
          <option selected>Pilih Qori</option>
          <option value="01">Abdullah Al-Juhany</option>
          <option value="02">Abdul Muhsin Al-Qasim</option>
          <option value="03">Abdurrahman As-Sudais</option>
          <option value="04">Ibrahim Al-Dossari</option>
          <option value="05">Misyari Rasyid Al-Afasi</option>
        </select>
      </div>
      <button class="btn btn-pill d-flex justify-content-between align-items-center" id="darkModeToggleMobile">
        <span>Ganti Tema</span>
        <i class="bi bi-moon-fill" id="darkModeIconMobile"></i>
      </button>
    </div>
  </div>
</div>

<div class="container mt-4">
  <div id="homePage" class="page active-page">
    <div id="surahList" class="mt-4 row g-3"></div>
  </div>

  <div id="detailPage" class="page">
    <div class="text-center my-4">
      <h3 id="surahTitle" style="font-weight: 600; font-size: 1.75rem;"></h3>
    </div>
    <div id="versesContainer"></div>
    <div class="fab-container">
        <div class="fab-options">
            <button class="fab-option btn-pill" onclick="changeFontSize('decrease')" data-bs-toggle="tooltip" title="Perkecil Teks">
                <i class="bi bi-zoom-out"></i>
            </button>
            <button class="fab-option btn-pill" onclick="changeFontSize('increase')" data-bs-toggle="tooltip" title="Perbesar Teks">
                <i class="bi bi-zoom-in"></i>
            </button>
            <button class="fab-option btn-pill" onclick="showPage('homePage')" data-bs-toggle="tooltip" title="Kembali">
                <i class="bi bi-arrow-left"></i>
            </button>
            <button class="fab-option btn-pill" onclick="stopAudio()" data-bs-toggle="tooltip" title="Stop">
                <i class="bi bi-stop-fill"></i>
            </button>
            <button class="fab-option btn-pill" onclick="playAllVerses()" data-bs-toggle="tooltip" title="Putar Semua">
                <i class="bi bi-play-fill"></i>
            </button>
        </div>
        <button class="fab-main btn-pill" id="fabToggle">
            <i class="bi bi-gear-fill"></i>
        </button>
    </div>
</div>


<div class="loading" id="loadingSpinner">
  <div class="loading-spinner"></div>
  <p class="mt-3">Sedang memuat data...</p>
</div>
<audio id="audioPlayer" controls hidden></audio>

<div id="tahlilPage" class="container mt-4 page">
  <h2 class="text-center mt-8" style="font-weight: 600; font-size: 1.75rem;">Bacaan Tahlil</h2>
  <div id="tahlilContent" class="mt-3"></div>
  <div class="fab-container">
      <button class="fab-main btn-pill" onclick="showPage('homePage')" title="Kembali">
          <i class="bi bi-arrow-left"></i>
      </button>
  </div>
</div>

<div id="hadrohPage" class="container mt-4 page">
  <h2 class="text-center mt-8" style="font-weight: 600; font-size: 1.75rem;">Daftar Hadroh</h2>
  <div id="hadrohList" class="mt-3"></div>
  <button class="btn btn-pill mb-3" onclick="showPage('tahlilPage', 3)">
    <i class="bi bi-arrow-right-circle"></i> Lanjut Tahlil
  </button>
  <div class="fab-container">
      <button class="fab-main btn-pill" onclick="showPage('homePage')" title="Kembali">
          <i class="bi bi-arrow-left"></i>
      </button>
  </div>
</div>

<script>
const API_URL = "https://equran.id/api/v2";
let allSurahs = [], versesData = [], currentIndex = 0;

// [BARU] Variabel untuk mengelola ukuran font Arab
let currentFontSize = 1.875; // Ukuran awal dalam rem (sesuai CSS)
const FONT_STEP = 0.125;     // Seberapa besar perubahan ukuran setiap klik
const MAX_FONT_SIZE = 3;       // Ukuran maksimum
const MIN_FONT_SIZE = 1.25;    // Ukuran minimum

function toggleDarkMode(force = null) {
  const body = document.body;
  const icons = document.querySelectorAll("#darkModeIcon, #darkModeIconMobile");
  const isDark = force !== null ? force : !body.classList.contains("dark-mode");
  body.classList.toggle("dark-mode", isDark);
  body.classList.toggle("light-mode", !isDark);
  icons.forEach(icon => {
    icon.classList.toggle("bi-sun-fill", !isDark);
    icon.classList.toggle("bi-moon-fill", isDark);
  });
}

document.addEventListener("DOMContentLoaded", () => {
  const toggleBtn = document.getElementById("darkModeToggle");
  if (toggleBtn) {
    toggleBtn.addEventListener("click", () => toggleDarkMode());
  }
  const toggleBtnMobile = document.getElementById("darkModeToggleMobile");
  if (toggleBtnMobile) {
    toggleBtnMobile.addEventListener("click", () => toggleDarkMode());
  }
  const qoriSelect = document.getElementById("qoriSelect");
  const qoriSelectMobile = document.getElementById("qoriSelectMobile");
  if (qoriSelect && qoriSelectMobile) {
    qoriSelectMobile.addEventListener('change', () => { qoriSelect.value = qoriSelectMobile.value; });
    qoriSelect.addEventListener('change', () => { qoriSelectMobile.value = qoriSelect.value; });
  }

  const fabToggle = document.getElementById('fabToggle');
  const fabContainer = document.querySelector('#detailPage .fab-container'); // lebih spesifik
  if(fabToggle && fabContainer) {
    fabToggle.addEventListener('click', () => {
      fabContainer.classList.toggle('open');
      const icon = fabToggle.querySelector('i');
      icon.classList.toggle('bi-gear-fill');
      icon.classList.toggle('bi-x-lg');
    });
  }

  var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
  var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
    return new bootstrap.Tooltip(tooltipTriggerEl)
  })
});


function showLoading(show) {
  document.getElementById("loadingSpinner").style.display = show ? 'block' : 'none';
}

function showPage(id) {
  document.querySelectorAll(".page").forEach(p => p.classList.remove("active-page"));
  document.getElementById(id).classList.add("active-page");
}

async function loadSurahList() {
  showLoading(true);
  const res = await fetch(`${API_URL}/surat`);
  const data = await res.json();
  allSurahs = data.data;
  renderSurahList(allSurahs);
  showLoading(false);
}

function renderSurahList(surahList) {
  const container = document.getElementById("surahList");
  container.innerHTML = "";
  surahList.forEach(s => {
    const card = document.createElement("div");
    card.className = "col-lg-4 col-md-6";
    card.innerHTML = `
      <div class="surah-card">
        <div class="surah-title">${s.namaLatin}</div>
        <div class="surah-meta">
          <span class="badge bg-primary me-2">${s.nomor}</span>
          ${s.nama} • ${s.arti}
        </div>
        <button class="btn btn-pill w-100" onclick="loadSurahDetail(${s.nomor})">
          <i class="bi bi-journal-text"></i> Lihat Surah
        </button>
      </div>`;
    container.appendChild(card);
  });
}

document.getElementById("searchInput").addEventListener("input", e => {
  const val = e.target.value.toLowerCase();
  const filtered = allSurahs.filter(s =>
    s.nama.toLowerCase().includes(val) ||
    s.namaLatin.toLowerCase().includes(val) ||
    s.nomor.toString().includes(val)
  );
  renderSurahList(filtered);
});

async function loadSurahDetail(nomor) {
  showLoading(true);
  const res = await fetch(`${API_URL}/surat/${nomor}`);
  const data = await res.json();
  versesData = data.data.ayat;
  document.getElementById("surahTitle").innerText = `${data.data.namaLatin} (${data.data.arti})`;

  const container = document.getElementById("versesContainer");
  container.innerHTML = "";

  versesData.forEach((v, i) => {
    const div = document.createElement("div");
    div.className = "verse-container";
    div.setAttribute("id", `verse-${i}`);
    div.innerHTML = `
      <div class="d-flex justify-content-between align-items-center mb-3">
        <span class="badge bg-primary text-dark rounded-pill">${v.nomorAyat}</span>
        <button class="btn btn-pill btn-sm" onclick="playVerse(${i})">
          <i class="bi bi-volume-up-fill me-1"></i> Putar
        </button>
      </div>
      <div class="verse-text-arab">${v.teksArab}</div>
      <p class="verse-text-latin mt-4">${v.teksLatin}</p>
      <p style="color: rgba(255, 255, 255, 0.9);">${v.teksIndonesia}</p>`;
    container.appendChild(div);
  });
  
  applyCurrentFontSize(); // [BARU] Terapkan ukuran font saat ini ke ayat yang baru dimuat
  showPage("detailPage");
  showLoading(false);
  window.scrollTo(0, 0);
}

function getSelectedQori() {
  return document.getElementById("qoriSelect").value;
}

function playVerse(index) {
  // [BARU] Validasi qori
  const selectedQori = getSelectedQori();
  if (selectedQori === "Pilih Qori") {
    alert("Silakan pilih Qori terlebih dahulu pada menu di pojok kanan atas.");
    return; // Hentikan fungsi jika qori belum dipilih
  }

  currentIndex = index;
  const verse = versesData[index];
  const audio = document.getElementById("audioPlayer");
  audio.src = verse.audio[selectedQori];
  audio.play();
  highlightVerse(index);
}

function highlightVerse(index) {
  document.querySelectorAll(".verse-container").forEach(el => el.classList.remove("active"));
  const verseEl = document.getElementById(`verse-${index}`);
  if (verseEl) {
    verseEl.classList.add("active");
    verseEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
  }
}

function playAllVerses() {
  // [BARU] Validasi qori
  if (getSelectedQori() === "Pilih Qori") {
    alert("Silakan pilih Qori terlebih dahulu pada menu di pojok kanan atas.");
    return; // Hentikan fungsi jika qori belum dipilih
  }
  
  if (!versesData.length) return;
  currentIndex = 0;
  playSequential();
}

function playSequential() {
  if (currentIndex >= versesData.length) return;
  const verse = versesData[currentIndex];
  const audio = document.getElementById("audioPlayer");
  audio.src = verse.audio[getSelectedQori()];
  audio.play();
  highlightVerse(currentIndex);
  audio.onended = () => {
    currentIndex++;
    if (currentIndex < versesData.length) {
      playSequential();
    }
  };
}

function stopAudio() {
  const audio = document.getElementById("audioPlayer");
  audio.pause();
  audio.currentTime = 0;
  document.querySelectorAll(".verse-container").forEach(el => el.classList.remove("active"));
}

// [BARU] Fungsi untuk menerapkan ukuran font saat ini ke semua elemen ayat
function applyCurrentFontSize() {
  document.querySelectorAll('#versesContainer .verse-text-arab').forEach(verse => {
    verse.style.fontSize = `${currentFontSize}rem`;
  });
}

// [BARU] Fungsi untuk mengubah ukuran font
function changeFontSize(direction) {
  if (direction === 'increase' && currentFontSize < MAX_FONT_SIZE) {
    currentFontSize += FONT_STEP;
  } else if (direction === 'decrease' && currentFontSize > MIN_FONT_SIZE) {
    currentFontSize -= FONT_STEP;
  }
  applyCurrentFontSize(); // Terapkan ukuran baru
}


async function loadTahlil(verseIndex = null) {
  const container = document.getElementById("tahlilContent");
  container.innerHTML = "";
  try {
    const res = await fetch("tahlil.json");
    const data = await res.json();
    data.result.forEach((item, index) => {
      container.innerHTML += `
        <div class="verse-container mb-4" id="tahlil-verse-${index}">
          ${item.judul ? `<h5 class="mb-3" style="color: var(--primary-400); font-weight: 600;">${item.judul}</h5>` : ''}
          <div class="verse-text-arab">${item.arab}</div>
          ${item.latin ? `<p class="verse-text-latin">${item.latin}</p>` : ''}
          <p style="color: rgba(255, 255, 255, 0.9);">${item.id}</p>
          ${index + 1 === 4 ? '<button class="btn btn-pill mt-3" onclick="showPage(\'hadrohPage\')"><i class="bi bi-music-note-list"></i> Lihat Hadroh</button>' : ''}
        </div>`;
    });
    if (verseIndex !== null) {
      const targetVerse = document.getElementById(`tahlil-verse-${verseIndex}`);
      if (targetVerse) {
        targetVerse.style.backgroundColor = "#2c2c2c";
        targetVerse.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }
    }
  } catch (err) {
    container.innerHTML = `<div class="text-danger">Gagal memuat tahlil: ${err.message}</div>`;
  }
}

async function loadHadroh() {
  const container = document.getElementById("hadrohList");
  container.innerHTML = "";
  try {
    const res = await fetch("hadroh.json");
    const data = await res.json();
    data.result.forEach(item => {
      container.innerHTML += `
        <div class="verse-container mb-4">
          <h5 class="mb-3" style="color: var(--primary-400); font-weight: 600;">${item.nama}</h5>
          ${item.ayah ? `<p>${item.ayah}</p>` : ""}
        </div>`;
    });
  } catch (err) {
    container.innerHTML = `<div class="text-danger">Gagal memuat hadroh: ${err.message}</div>`;
  }
}

function showPage(id, verseIndex = null) {
  document.querySelectorAll(".page").forEach(p => p.classList.remove("active-page"));
  const page = document.getElementById(id);
  page.classList.add("active-page");
  if (id === "tahlilPage") { loadTahlil(verseIndex); }
  if (id === "hadrohPage") { loadHadroh(); }
}
</script>
<script>
window.addEventListener('DOMContentLoaded', () => {
  const sidebarContainer = document.getElementById("sidebarControlsContainer");

  const divider = document.createElement("hr");
  divider.className = "my-3";
  sidebarContainer.appendChild(divider);

  const tahlilBtn = document.createElement("button");
  tahlilBtn.innerHTML = '<i class="bi bi-book-half me-2"></i>Buka Tahlil';
  tahlilBtn.className = "btn btn-pill my-2 w-100";
  tahlilBtn.onclick = () => {
      showPage("tahlilPage");
      bootstrap.Offcanvas.getInstance(document.getElementById('sidebarMenu')).hide();
  };
  sidebarContainer.appendChild(tahlilBtn);

  const hadrohBtn = document.createElement("button");
  hadrohBtn.innerHTML = '<i class="bi bi-music-note-list me-2"></i>Buka Hadroh';
  hadrohBtn.className = "btn btn-pill my-2 w-100";
  hadrohBtn.onclick = () => {
      showPage("hadrohPage");
      bootstrap.Offcanvas.getInstance(document.getElementById('sidebarMenu')).hide();
  };
  sidebarContainer.appendChild(hadrohBtn);
});

function closeFloatingModal() {
  const modal = document.getElementById("floatingModal");
  if (modal) modal.remove();
}

async function showFloatingModal() {
  try {
    const oldModal = document.getElementById("floatingModal");
    if (oldModal) oldModal.remove();
    const res = await fetch("update-modal.html");
    const htmlText = await res.text();
    const tempDiv = document.createElement("div");
    tempDiv.innerHTML = htmlText.trim();
    document.body.appendChild(tempDiv);
    const updateRes = await fetch("update.json");
    const data = await updateRes.json();
    const fiturList = data.fitur_baru.map(f => `<li> ${f}</li>`).join("");
    const bug = data.bug.map(f => `<li> ${f}</li>`).join("");
    const html = `
      <p><strong><i class="bi bi-person-vcard-fill me-2"></i>Create by:</strong> ${data.created_by}</p>
      <p><strong><i class="bi bi-github me-2"></i>Update versi:</strong> ${data.version}</p>
      <p><strong><i class="bi bi-calendar-event me-2"></i>Tanggal update:</strong> ${data.tanggal_update}</p>
      <p><strong><i class="bi bi-rocket-fill me-2"></i>Apa yang baru:</strong></p>
      <ul>${fiturList}</ul>
      <p><strong><i class="bi bi-bug me-2"></i>Bug:</strong></p>
      <ul>${bug}</ul>
    `;
    document.getElementById("floatingContent").innerHTML = html;
  } catch (err) {
    console.error(err);
  }
}

window.addEventListener("load", () => {
  showFloatingModal();
  loadSurahList();
});
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
